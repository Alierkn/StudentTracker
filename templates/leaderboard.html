{% extends "base.html" %}

{% block title %}YarÄ±ÅŸma - EducationalTR Ã–ÄŸrenci Takip Sistemi{% endblock %}

{% block content %}
<div class="leaderboard-page">
    <div class="leaderboard-header">
        <h1>ğŸ† Ã‡alÄ±ÅŸma YarÄ±ÅŸmasÄ±</h1>
        <p class="subtitle">En Ã§ok Ã§alÄ±ÅŸan Ã¶ÄŸrenciler - Streak liderliÄŸi</p>
    </div>

    <!-- Filtreler -->
    <div class="leaderboard-filters">
        <button class="filter-btn active" onclick="filterLeaderboard('streak')" data-filter="streak">
            ğŸ”¥ Streak
        </button>
        <button class="filter-btn" onclick="filterLeaderboard('hours')" data-filter="hours">
            â° Toplam Saat
        </button>
        <button class="filter-btn" onclick="filterLeaderboard('sessions')" data-filter="sessions">
            ğŸ“– Ã‡alÄ±ÅŸma SayÄ±sÄ±
        </button>
    </div>

    <!-- Leaderboard Listesi -->
    <div class="leaderboard-container">
        <div id="streak-leaderboard" class="leaderboard-list active">
            <div class="leaderboard-title">
                <h2>ğŸ”¥ Ãœst Ãœste Ã‡alÄ±ÅŸma Serisi</h2>
                <p>En uzun streak rekorlarÄ±</p>
            </div>
            
            {% if streak_leaderboard %}
                {% for student in streak_leaderboard %}
                <div class="leaderboard-item {% if student.id == session.user_id %}current-user{% endif %}">
                    <div class="rank-badge">
                        {% if loop.index == 1 %}
                            <span class="rank-number gold">ğŸ¥‡</span>
                        {% elif loop.index == 2 %}
                            <span class="rank-number silver">ğŸ¥ˆ</span>
                        {% elif loop.index == 3 %}
                            <span class="rank-number bronze">ğŸ¥‰</span>
                        {% else %}
                            <span class="rank-number">{{ loop.index }}</span>
                        {% endif %}
                    </div>
                    <div class="leaderboard-content">
                        <div class="student-info">
                            <h3>{{ student.full_name }}</h3>
                            <p class="student-username">@{{ student.username }}</p>
                        </div>
                        <div class="leaderboard-stats">
                            <div class="stat-item">
                                <span class="stat-label">Mevcut Streak</span>
                                <span class="stat-value streak-value">{{ student.current_streak or 0 }} ğŸ”¥</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">En Uzun Streak</span>
                                <span class="stat-value">{{ student.longest_streak or 0 }} gÃ¼n</span>
                            </div>
                        </div>
                    </div>
                    {% if student.id == session.user_id %}
                    <div class="you-badge">Sen</div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <p>HenÃ¼z yarÄ±ÅŸma verisi yok. Ä°lk Ã§alÄ±ÅŸma kaydÄ±nÄ± ekleyerek baÅŸla! ğŸš€</p>
                </div>
            {% endif %}
        </div>

        <div id="hours-leaderboard" class="leaderboard-list">
            <div class="leaderboard-title">
                <h2>â° Toplam Ã‡alÄ±ÅŸma Saatleri</h2>
                <p>En Ã§ok Ã§alÄ±ÅŸan Ã¶ÄŸrenciler</p>
            </div>
            
            {% if hours_leaderboard %}
                {% for student in hours_leaderboard %}
                <div class="leaderboard-item {% if student.id == session.user_id %}current-user{% endif %}">
                    <div class="rank-badge">
                        {% if loop.index == 1 %}
                            <span class="rank-number gold">ğŸ¥‡</span>
                        {% elif loop.index == 2 %}
                            <span class="rank-number silver">ğŸ¥ˆ</span>
                        {% elif loop.index == 3 %}
                            <span class="rank-number bronze">ğŸ¥‰</span>
                        {% else %}
                            <span class="rank-number">{{ loop.index }}</span>
                        {% endif %}
                    </div>
                    <div class="leaderboard-content">
                        <div class="student-info">
                            <h3>{{ student.full_name }}</h3>
                            <p class="student-username">@{{ student.username }}</p>
                        </div>
                        <div class="leaderboard-stats">
                            <div class="stat-item">
                                <span class="stat-label">Toplam Saat</span>
                                <span class="stat-value hours-value">{{ "%.1f"|format(student.total_hours or 0) }} â°</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Ã‡alÄ±ÅŸma GÃ¼nÃ¼</span>
                                <span class="stat-value">{{ student.study_days or 0 }} gÃ¼n</span>
                            </div>
                        </div>
                    </div>
                    {% if student.id == session.user_id %}
                    <div class="you-badge">Sen</div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <p>HenÃ¼z yarÄ±ÅŸma verisi yok. Ä°lk Ã§alÄ±ÅŸma kaydÄ±nÄ± ekleyerek baÅŸla! ğŸš€</p>
                </div>
            {% endif %}
        </div>

        <div id="sessions-leaderboard" class="leaderboard-list">
            <div class="leaderboard-title">
                <h2>ğŸ“– Toplam Ã‡alÄ±ÅŸma SayÄ±sÄ±</h2>
                <p>En aktif Ã¶ÄŸrenciler</p>
            </div>
            
            {% if sessions_leaderboard %}
                {% for student in sessions_leaderboard %}
                <div class="leaderboard-item {% if student.id == session.user_id %}current-user{% endif %}">
                    <div class="rank-badge">
                        {% if loop.index == 1 %}
                            <span class="rank-number gold">ğŸ¥‡</span>
                        {% elif loop.index == 2 %}
                            <span class="rank-number silver">ğŸ¥ˆ</span>
                        {% elif loop.index == 3 %}
                            <span class="rank-number bronze">ğŸ¥‰</span>
                        {% else %}
                            <span class="rank-number">{{ loop.index }}</span>
                        {% endif %}
                    </div>
                    <div class="leaderboard-content">
                        <div class="student-info">
                            <h3>{{ student.full_name }}</h3>
                            <p class="student-username">@{{ student.username }}</p>
                        </div>
                        <div class="leaderboard-stats">
                            <div class="stat-item">
                                <span class="stat-label">Toplam Ã‡alÄ±ÅŸma</span>
                                <span class="stat-value sessions-value">{{ student.total_sessions or 0 }} ğŸ“–</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Ortalama Verimlilik</span>
                                <span class="stat-value">{{ "%.0f"|format(student.avg_efficiency or 0) }}%</span>
                            </div>
                        </div>
                    </div>
                    {% if student.id == session.user_id %}
                    <div class="you-badge">Sen</div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <p>HenÃ¼z yarÄ±ÅŸma verisi yok. Ä°lk Ã§alÄ±ÅŸma kaydÄ±nÄ± ekleyerek baÅŸla! ğŸš€</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function filterLeaderboard(type) {
    // TÃ¼m leaderboard listelerini gizle
    document.querySelectorAll('.leaderboard-list').forEach(list => {
        list.classList.remove('active');
    });
    
    // SeÃ§ili listeyi gÃ¶ster
    document.getElementById(type + '-leaderboard').classList.add('active');
    
    // Filtre butonlarÄ±nÄ± gÃ¼ncelle
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-filter="${type}"]`).classList.add('active');
}
</script>
{% endblock %}

