{% extends "base.html" %}

{% block title %}Admin Panel - EducationalTR{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="dashboard-header">
        <h1>ğŸ‘¨â€ğŸ’¼ Admin Paneli</h1>
        <p class="subtitle">TÃ¼m Ã¶ÄŸrencilerin Ã§alÄ±ÅŸma verilerini gÃ¶rÃ¼ntÃ¼leyin</p>
    </div>

    <div class="students-grid">
        {% for item in student_stats %}
        <div class="student-card">
            <div class="student-header">
                <h3>{{ item.student.full_name }}</h3>
                <span class="student-username">@{{ item.student.username }}</span>
            </div>
            <div class="student-stats">
                <div class="stat-item">
                    <span class="stat-label">Toplam Ã‡alÄ±ÅŸma:</span>
                    <span class="stat-value">{{ item.stats.total_sessions or 0 }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Toplam Saat:</span>
                    <span class="stat-value">{{ "%.1f"|format(item.stats.total_hours or 0) }} saat</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ortalama Verimlilik:</span>
                    <span class="stat-value">{{ "%.0f"|format(item.stats.avg_efficiency or 0) }}%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ã‡alÄ±ÅŸma GÃ¼nÃ¼:</span>
                    <span class="stat-value">{{ item.stats.study_days or 0 }} gÃ¼n</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">SÄ±nav OrtalamasÄ±:</span>
                    <span class="stat-value">{{ "%.1f"|format(item.exam_avg) }}%</span>
                </div>
            </div>
            <div class="student-actions">
                <a href="{{ url_for('admin_student_detail', student_id=item.student.id) }}" class="btn btn-primary btn-sm">DetaylarÄ± GÃ¶r</a>
                <button onclick="deleteStudent({{ item.student.id }}, '{{ item.student.username }}')" class="btn btn-danger btn-sm" title="Ã–ÄŸrenciyi Sil">
                    ğŸ—‘ï¸ Sil
                </button>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if not student_stats %}
    <div class="empty-state">
        <p>HenÃ¼z kayÄ±tlÄ± Ã¶ÄŸrenci yok.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    function deleteStudent(studentId, username) {
        if (!confirm(`"${username}" kullanÄ±cÄ±sÄ±nÄ± silmek istediÄŸinize emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz! Ã–ÄŸrencinin tÃ¼m Ã§alÄ±ÅŸma kayÄ±tlarÄ±, sÄ±nav sonuÃ§larÄ± ve ders programlarÄ± da silinecektir.`)) {
            return;
        }
        
        fetch(`/admin/student/${studentId}/delete`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Ã–ÄŸrenci baÅŸarÄ±yla silindi!');
                location.reload();
            } else {
                alert('Hata: ' + (data.error || 'Bilinmeyen hata'));
            }
        })
        .catch(error => {
            console.error('Silme hatasÄ±:', error);
            alert('Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');
        });
    }
</script>
{% endblock %}

